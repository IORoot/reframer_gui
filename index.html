<!DOCTYPE html>
<html>
<head>
    <title>RF-1 Reframer - Video Reframing Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <link href="./styles.css" rel="stylesheet">
    <script src="./xknob.js"></script>
    <style>
        /* Custom styles for object classes grid responsiveness */
        #objectClassesGrid {
            display: grid;
            gap: 0.5rem;
            max-height: 12rem;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            padding: 0.75rem;
            background-color: #f9fafb;
        }
        
        /* Mobile first - 3 columns by default */
        #objectClassesGrid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        /* Small screens and up - 4 columns */
        @media (min-width: 640px) {
            #objectClassesGrid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Medium screens and up - 5 columns */
        @media (min-width: 768px) {
            #objectClassesGrid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        /* Large screens and up - 6 columns */
        @media (min-width: 1024px) {
            #objectClassesGrid {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        /* Button styling for object classes */
        .object-class-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border: 1px solid;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Responsive button text sizing */
        @media (max-width: 639px) {
            .object-class-btn {
                font-size: 0.625rem;
                padding: 0.125rem 0.25rem;
            }
        }
        
        @media (min-width: 640px) and (max-width: 767px) {
            .object-class-btn {
                font-size: 0.6875rem;
                padding: 0.1875rem 0.375rem;
            }
        }
        
        @media (min-width: 768px) {
            .object-class-btn {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
        }
        
        /* Debug styles to visualize responsive breakpoints */
        #objectClassesGrid::before {
            content: "Mobile (3 cols)";
            position: absolute;
            top: -20px;
            left: 0;
            font-size: 10px;
            color: red;
            background: white;
            padding: 2px 4px;
            border: 1px solid red;
        }
        
        @media (min-width: 640px) {
            #objectClassesGrid::before {
                content: "Small (4 cols)";
                color: orange;
                border-color: orange;
            }
        }
        
        @media (min-width: 768px) {
            #objectClassesGrid::before {
                content: "Medium (5 cols)";
                color: green;
                border-color: green;
            }
        }
        
        @media (min-width: 1024px) {
            #objectClassesGrid::before {
                content: "Large (6 cols)";
                color: blue;
                border-color: blue;
            }
        }
        
        /* Alternative responsive approach using container queries or JavaScript fallback */
        .object-classes-container {
            position: relative;
        }
        
        /* Model size button styles */
        .model-size-btn {
            background-color: #f9fafb;
            border-color: #d1d5db;
            color: #6b7280;
            transition: all 0.15s ease-in-out;
        }
        
        .model-size-btn:hover {
            background-color: #f3f4f6;
            border-color: #9ca3af;
            color: #374151;
        }
        
        .model-size-btn.selected {
            background-color: #3b82f6;
            border-color: #2563eb;
            color: white;
        }
        
        .model-size-btn.selected:hover {
            background-color: #2563eb;
            border-color: #1d4ed8;
        }
    </style>
</head>
<body class="font-sans bg-gray-100 m-0 p-0 h-screen flex">

    <svg style="display: none;">
        <defs id="sample_gfx">
            <symbol id="long-stick" viewBox="-6 -6 12 12">
                <circle cx="0" cy="0" r="2.5" stroke="#2e3436" fill="#888a85" stroke-width="0.25"></circle>
                <rect x="-1" y="-5" rx="1" ry="1" width="2" height="10" stroke="#2e3436" fill="#babdb6" stroke-width="0.25"></rect>
                <line x1="0" y1="-3.75" x2="0" y2="-4.5" stroke="#2e3436" stroke-width="0.5px" stroke-linecap="round"></line>
            </symbol>

            <symbol id="aspect-ratio" width="16" height="16" fill="currentColor" class="bi bi-aspect-ratio" viewBox="0 0 16 16">
                <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5zM1.5 3a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5z"/>
                <path d="M2 4.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H3v2.5a.5.5 0 0 1-1 0zm12 7a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H13V8.5a.5.5 0 0 1 1 0z"/>
            </symbol>


            <symbol id="simpleknob-black" viewBox="0 0 42 42" fill="none" >
                <g id="simpleknob_black">
                    <g id="base" filter="url(#filter0_ii_549_2784)">
                        <circle cx="21" cy="21" r="20" fill="url(#paint0_linear_549_2784)" />
                    </g>
                    <g id="knurled" filter="url(#filter1_ii_549_2784)">
                        <path
                            d="M19.3447 2.51483C20.4251 2.19553 21.5749 2.19553 22.6553 2.51483V2.51483C23.2193 2.68152 23.8053 2.76206 24.3933 2.75372V2.75372C25.5198 2.73776 26.6269 3.04795 27.5811 3.6469V3.6469C28.0793 3.95958 28.6218 4.19522 29.1903 4.34586V4.34586C30.2793 4.63441 31.2617 5.23179 32.0189 6.06598V6.06598C32.4142 6.50145 32.873 6.87472 33.3798 7.17315V7.17315C34.3506 7.74483 35.1353 8.58508 35.6394 9.59263V9.59263C35.9026 10.1186 36.2437 10.6018 36.6512 11.0259V11.0259C37.4317 11.8383 37.9607 12.8591 38.1742 13.9653V13.9653C38.2857 14.5428 38.4838 15.1001 38.7618 15.6184V15.6184C39.2942 16.6113 39.5281 17.737 39.4353 18.8597V18.8597C39.3869 19.4459 39.4272 20.036 39.555 20.6101V20.6101C39.7999 21.7097 39.7214 22.8568 39.3291 23.9129V23.9129C39.1243 24.4642 39.004 25.0433 38.9722 25.6306V25.6306C38.9112 26.7556 38.5262 27.8389 37.8635 28.75V28.75C37.5176 29.2257 37.2455 29.7508 37.0564 30.3077V30.3077C36.6942 31.3745 36.0312 32.3138 35.1472 33.0124V33.0124C34.6858 33.377 34.2821 33.8093 33.9498 34.2945V34.2945C33.3132 35.2241 32.4213 35.9496 31.3817 36.3838V36.3838C30.839 36.6104 30.3337 36.9177 29.8827 37.2953V37.2953C29.019 38.0186 27.9644 38.4767 26.8463 38.6143V38.6143C26.2625 38.6861 25.693 38.8457 25.1569 39.0876V39.0876C24.13 39.551 22.991 39.7076 21.8772 39.5384V39.5384C21.2957 39.4501 20.7043 39.4501 20.1228 39.5384V39.5384C19.009 39.7076 17.8699 39.551 16.8431 39.0876V39.0876C16.307 38.8457 15.7375 38.6861 15.1537 38.6143V38.6143C14.0355 38.4767 12.981 38.0186 12.1172 37.2953V37.2953C11.6663 36.9177 11.161 36.6104 10.6182 36.3838V36.3838C9.57864 35.9496 8.6868 35.2241 8.05021 34.2945V34.2945C7.71788 33.8093 7.31417 33.377 6.85274 33.0124V33.0124C5.96882 32.3138 5.3058 31.3745 4.9436 30.3077V30.3077C4.75452 29.7508 4.4824 29.2256 4.13646 28.75V28.75C3.47379 27.8389 3.08877 26.7556 3.02782 25.6306V25.6306C2.99601 25.0433 2.87567 24.4642 2.67088 23.9129V23.9129C2.27859 22.8568 2.20013 21.7097 2.44496 20.61V20.61C2.57277 20.036 2.61313 19.4459 2.56468 18.8597V18.8597C2.47188 17.737 2.7058 16.6113 3.23824 15.6184V15.6184C3.51619 15.1001 3.71426 14.5428 3.82575 13.9653V13.9653C4.03931 12.8591 4.56826 11.8383 5.34883 11.0259V11.0259C5.75631 10.6018 6.0974 10.1186 6.36055 9.59263V9.59263C6.86464 8.58508 7.64938 7.74483 8.62019 7.17315V7.17315C9.12698 6.87472 9.58579 6.50145 9.98109 6.06598V6.06598C10.7383 5.23179 11.7207 4.63441 12.8097 4.34586V4.34586C13.3782 4.19522 13.9207 3.95958 14.4189 3.6469V3.6469C15.3731 3.04795 16.4802 2.73776 17.6067 2.75372V2.75372C18.1947 2.76206 18.7807 2.68152 19.3447 2.51483V2.51483Z"
                            fill="url(#paint1_linear_549_2784)" />
                    </g>
                    <g id="center" filter="url(#filter2_di_549_2784)">
                        <circle cx="21" cy="21" r="8.71795" fill="url(#paint2_radial_549_2784)" />
                    </g>
                    <g id="indicator" filter="url(#filter3_i_549_2784)">
                        <rect x="18.4359" y="1" width="5.1282" height="19.4872" rx="2.5641" fill="url(#paint3_radial_549_2784)" />
                    </g>
                </g>
                <defs>
                    <filter id="filter0_ii_549_2784" x="-1" y="-1" width="42" height="46" filterUnits="userSpaceOnUse"
                        color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="-4" dy="-4" />
                        <feGaussianBlur stdDeviation="1" /> 
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_549_2784" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dy="4" />
                        <feGaussianBlur stdDeviation="2" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0" />
                        <feBlend mode="normal" in2="effect1_innerShadow_549_2784" result="effect2_innerShadow_549_2784" />
                    </filter>
                    <filter id="filter1_ii_549_2784" x="1.80539" y="1.77536" width="38.8892" height="38.8293"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="1" dy="1" />
                        <feGaussianBlur stdDeviation="0.5" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.8 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_549_2784" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="-0.5" dy="-0.5" />
                        <feGaussianBlur stdDeviation="0.25" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" />
                        <feBlend mode="normal" in2="effect1_innerShadow_549_2784" result="effect2_innerShadow_549_2784" />
                    </filter>
                    <filter id="filter2_di_549_2784" x="12.282" y="12.2821" width="23.4359" height="23.4359"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="1" dy="1" />
                        <feGaussianBlur stdDeviation="0.5" />
                        <feComposite in2="hardAlpha" operator="out" />
                        <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.8 0" />
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_549_2784" />
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_549_2784" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="6" dy="6" />
                        <feGaussianBlur stdDeviation="6" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0.252329 0 0 0 0 0.252329 0 0 0 0 0.252329 0 0 0 0.9 0" />
                        <feBlend mode="normal" in2="shape" result="effect2_innerShadow_549_2784" />
                    </filter>
                    <filter id="filter3_i_549_2784" x="18.4359" y="1" width="9.1282" height="23.4872" filterUnits="userSpaceOnUse"
                        color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="4" dy="4" />
                        <feGaussianBlur stdDeviation="3" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0.242695 0 0 0 0 0.242695 0 0 0 0 0.242695 0 0 0 0.81 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_549_2784" />
                    </filter>
                    <linearGradient id="paint0_linear_549_2784" x1="7.0177" y1="7.37168" x2="34.4513" y2="34.8053"
                        gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E7E7E7" />
                        <stop offset="1" stop-color="#C2C2C4" />
                    </linearGradient>
                    <linearGradient id="paint1_linear_549_2784" x1="21" y1="2.02564" x2="21" y2="39.9744"
                        gradientUnits="userSpaceOnUse">
                        <stop stop-color="#C7C7C9" />
                        <stop offset="1" stop-color="#C5C5C7" />
                    </linearGradient>
                    <radialGradient id="paint2_radial_549_2784" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                        gradientTransform="translate(26.641 26.641) rotate(-135) scale(9.91158)">
                        <stop stop-color="#C6C6C6" />
                        <stop offset="0.484375" stop-color="#535353" />
                        <stop offset="1" stop-color="#232323" />
                    </radialGradient>
                    <radialGradient id="paint3_radial_549_2784" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                        gradientTransform="translate(23.5641 11.2564) rotate(-90) scale(6.66667 4)">
                        <stop stop-color="white" />
                        <stop offset="0.484375" stop-color="#555555" />
                        <stop offset="1" stop-color="#222222" />
                    </radialGradient>
                </defs>
            </symbol>


            <symbol id="simpleknob-orange" viewBox="0 0 42 42" fill="none" >
                <g id="simpleknob_orange">
                    <g id="base" filter="url(#filter0_ii_459_2080)">
                        <circle cx="21" cy="21" r="20" fill="url(#paint0_linear_459_2080)" />
                    </g>
                    <g id="knurled" filter="url(#filter1_ii_459_2080)">
                        <path
                            d="M19.3447 2.51483C20.4251 2.19553 21.5749 2.19553 22.6553 2.51483V2.51483C23.2193 2.68152 23.8053 2.76206 24.3933 2.75372V2.75372C25.5198 2.73776 26.6269 3.04795 27.5811 3.6469V3.6469C28.0793 3.95958 28.6218 4.19522 29.1903 4.34586V4.34586C30.2793 4.63441 31.2617 5.23179 32.0189 6.06598V6.06598C32.4142 6.50145 32.873 6.87472 33.3798 7.17315V7.17315C34.3506 7.74483 35.1353 8.58508 35.6394 9.59263V9.59263C35.9026 10.1186 36.2437 10.6018 36.6512 11.0259V11.0259C37.4317 11.8383 37.9607 12.8591 38.1742 13.9653V13.9653C38.2857 14.5428 38.4838 15.1001 38.7618 15.6184V15.6184C39.2942 16.6113 39.5281 17.737 39.4353 18.8597V18.8597C39.3869 19.4459 39.4272 20.036 39.555 20.6101V20.6101C39.7999 21.7097 39.7214 22.8568 39.3291 23.9129V23.9129C39.1243 24.4642 39.004 25.0433 38.9722 25.6306V25.6306C38.9112 26.7556 38.5262 27.8389 37.8635 28.75V28.75C37.5176 29.2257 37.2455 29.7508 37.0564 30.3077V30.3077C36.6942 31.3745 36.0312 32.3138 35.1472 33.0124V33.0124C34.6858 33.377 34.2821 33.8093 33.9498 34.2945V34.2945C33.3132 35.2241 32.4213 35.9496 31.3817 36.3838V36.3838C30.839 36.6104 30.3337 36.9177 29.8827 37.2953V37.2953C29.019 38.0186 27.9644 38.4767 26.8463 38.6143V38.6143C26.2625 38.6861 25.693 38.8457 25.1569 39.0876V39.0876C24.13 39.551 22.991 39.7076 21.8772 39.5384V39.5384C21.2957 39.4501 20.7043 39.4501 20.1228 39.5384V39.5384C19.009 39.7076 17.8699 39.551 16.8431 39.0876V39.0876C16.307 38.8457 15.7375 38.6861 15.1537 38.6143V38.6143C14.0355 38.4767 12.981 38.0186 12.1172 37.2953V37.2953C11.6663 36.9177 11.161 36.6104 10.6182 36.3838V36.3838C9.57864 35.9496 8.6868 35.2241 8.05021 34.2945V34.2945C7.71788 33.8093 7.31417 33.377 6.85274 33.0124V33.0124C5.96882 32.3138 5.3058 31.3745 4.9436 30.3077V30.3077C4.75452 29.7508 4.4824 29.2256 4.13646 28.75V28.75C3.47379 27.8389 3.08877 26.7556 3.02782 25.6306V25.6306C2.99601 25.0433 2.87567 24.4642 2.67088 23.9129V23.9129C2.27859 22.8568 2.20013 21.7097 2.44496 20.61V20.61C2.57277 20.036 2.61313 19.4459 2.56468 18.8597V18.8597C2.47188 17.737 2.7058 16.6113 3.23824 15.6184V15.6184C3.51619 15.1001 3.71426 14.5428 3.82575 13.9653V13.9653C4.03931 12.8591 4.56826 11.8383 5.34883 11.0259V11.0259C5.75631 10.6018 6.0974 10.1186 6.36055 9.59263V9.59263C6.86464 8.58508 7.64938 7.74483 8.62019 7.17315V7.17315C9.12698 6.87472 9.58579 6.50145 9.98109 6.06598V6.06598C10.7383 5.23179 11.7207 4.63441 12.8097 4.34586V4.34586C13.3782 4.19522 13.9207 3.95958 14.4189 3.6469V3.6469C15.3731 3.04795 16.4802 2.73776 17.6067 2.75372V2.75372C18.1947 2.76206 18.7807 2.68152 19.3447 2.51483V2.51483Z"
                            fill="url(#paint1_linear_459_2080)" />
                    </g>
                    <g id="center" filter="url(#filter2_di_459_2080)">
                        <circle cx="21" cy="21" r="8.71795" fill="url(#paint2_radial_459_2080)" />
                    </g>
                    <g id="indicator" filter="url(#filter3_i_459_2080)">
                        <rect x="18.4359" y="1" width="5.12821" height="19.4872" rx="2.5641" fill="url(#paint3_radial_459_2080)" />
                    </g>
                </g>
                <defs>
                    <filter id="filter0_ii_459_2080" x="-1" y="-1" width="42" height="46" filterUnits="userSpaceOnUse"
                        color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="-4" dy="-4" />
                        <feGaussianBlur stdDeviation="1" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_459_2080" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dy="4" />
                        <feGaussianBlur stdDeviation="2" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0" />
                        <feBlend mode="normal" in2="effect1_innerShadow_459_2080" result="effect2_innerShadow_459_2080" />
                    </filter>
                    <filter id="filter1_ii_459_2080" x="1.80539" y="1.77536" width="38.8892" height="38.8293"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="1" dy="1" />
                        <feGaussianBlur stdDeviation="0.5" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.8 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_459_2080" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="-0.5" dy="-0.5" />
                        <feGaussianBlur stdDeviation="0.25" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" />
                        <feBlend mode="normal" in2="shape" result="effect2_innerShadow_459_2080" />
                    </filter>
                    <filter id="filter2_di_459_2080" x="12.282" y="12.2821" width="23.4359" height="23.4359"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="1" dy="1" />
                        <feGaussianBlur stdDeviation="0.5" />
                        <feComposite in2="hardAlpha" operator="out" />
                        <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.8 0" />
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_459_2080" />
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_459_2080" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="6" dy="6" />
                        <feGaussianBlur stdDeviation="6" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0.252329 0 0 0 0 0.252329 0 0 0 0 0.252329 0 0 0 0.9 0" />
                        <feBlend mode="normal" in2="shape" result="effect2_innerShadow_459_2080" />
                    </filter>
                    <filter id="filter3_i_459_2080" x="18.4359" y="1" width="9.1282" height="23.4872" filterUnits="userSpaceOnUse"
                        color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dx="4" dy="4" />
                        <feGaussianBlur stdDeviation="3" />
                        <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0.242695 0 0 0 0 0.242695 0 0 0 0 0.242695 0 0 0 0.81 0" />
                        <feBlend mode="normal" in2="shape" result="effect1_innerShadow_459_2080" />
                    </filter>
                    <linearGradient id="paint0_linear_459_2080" x1="7.0177" y1="7.37168" x2="34.4513" y2="34.8053"
                        gradientUnits="userSpaceOnUse">
                        <stop stop-color="#E7E7E7" />
                        <stop offset="1" stop-color="#C2C2C4" />
                    </linearGradient>
                    <linearGradient id="paint1_linear_459_2080" x1="21" y1="2.02564" x2="21" y2="39.9744"
                        gradientUnits="userSpaceOnUse">
                        <stop stop-color="#C7C7C9" />
                        <stop offset="1" stop-color="#C5C5C7" />
                    </linearGradient>
                    <radialGradient id="paint2_radial_459_2080" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                        gradientTransform="translate(26.641 26.641) rotate(-135) scale(9.91158)">
                        <stop stop-color="#C6C6C6" />
                        <stop offset="0.484375" stop-color="#535353" />
                        <stop offset="1" stop-color="#232323" />
                    </radialGradient>
                    <radialGradient id="paint3_radial_459_2080" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
                        gradientTransform="translate(23.5641 11.2564) rotate(-90) scale(6.66667 4)">
                        <stop stop-color="white" />
                        <stop offset="0.484375" stop-color="#555555" />
                        <stop offset="1" stop-color="#222222" />
                    </radialGradient>
                </defs>
            </symbol>

            <!-- Model Size Icons -->
            <symbol id="model-nano" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6"/>
                <path d="M1 12h6m6 0h6"/>
            </symbol>
            
            <symbol id="model-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 2v8m0 4v8"/>
                <path d="M2 12h8m4 0h8"/>
            </symbol>
            
            <symbol id="model-medium" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="7"/>
                <path d="M12 1v10m0 2v10"/>
                <path d="M1 12h10m2 0h10"/>
            </symbol>
            
            <symbol id="model-large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9"/>
                <path d="M12 0v12m0 0v12"/>
                <path d="M0 12h12m0 0h12"/>
            </symbol>
            
            <symbol id="model-xlarge" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="11"/>
                <path d="M12 0v12m0 0v12"/>
                <path d="M0 12h12m0 0h12"/>
                <circle cx="12" cy="12" r="3" fill="currentColor"/>
            </symbol>

            <!-- Toggle button icons -->
            <symbol id="face-detection-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </symbol>

            <symbol id="weighted-center-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </symbol>

            <symbol id="blend-saliency-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </symbol>

            <symbol id="smoothing-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </symbol>

            <symbol id="debug-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-4 4v3c0 2.21-1.79 4-4 4s-4-1.79-4-4v-3c0-2.21 1.79-4 4-4s4 1.79 4 4z"/>
            </symbol>

            <symbol id="help-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
            </symbol>

            <symbol id="recursive-search-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </symbol>

            <!-- Aspect ratio preset icons -->
            <symbol id="square-ratio" viewBox="0 0 24 24" fill="currentColor">
                <rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
            </symbol>

            <symbol id="portrait-ratio" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="2" width="12" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
            </symbol>

            <symbol id="vertical-ratio" viewBox="0 0 24 24" fill="currentColor">
                <rect x="7" y="2" width="10" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
            </symbol>

            <symbol id="landscape-ratio" viewBox="0 0 24 24" fill="currentColor">
                <rect x="2" y="6" width="20" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
            </symbol>
        </defs>
    </svg>

    <div class="flex w-full h-full m-4">
        <!-- Left side: Video preview -->
        <div class="w-2/3 h-full p-5 flex flex-col">
            <div class="flex items-center gap-4 mb-4">
                <svg viewBox="0 0 115 47" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-6 w-auto">
                    <path d="M0.272727 47V0.454544H13.9091C16.5152 0.454544 18.8182 1.00757 20.8182 2.11364C22.8333 3.21969 24.4091 4.76515 25.5455 6.75C26.697 8.73485 27.2727 11.0606 27.2727 13.7273C27.2727 16.3636 26.697 18.6742 25.5455 20.6591C24.4091 22.6288 22.8333 24.1667 20.8182 25.2727C18.8182 26.3636 16.5152 26.9091 13.9091 26.9091H1V25.4545H13.9091C16.2424 25.4545 18.303 24.9697 20.0909 24C21.8788 23.0303 23.2803 21.6667 24.2955 19.9091C25.3106 18.1515 25.8182 16.0909 25.8182 13.7273C25.8182 11.3485 25.3106 9.27273 24.2955 7.5C23.2803 5.72727 21.8788 4.35606 20.0909 3.38636C18.303 2.40151 16.2424 1.90909 13.9091 1.90909H1.72727V47H0.272727ZM18 25.8182L29.4545 47H27.8182L16.3636 25.8182H18ZM39.6477 47V0.454544H64.6477V1.90909H41.1023V23H62.4659V24.4545H41.1023V47H39.6477ZM92.5398 23V24.4545H75.1761V23H92.5398ZM114.148 0.454544V47H112.693V2H112.42L102.42 8.63636V6.90909L112.148 0.454544H114.148Z" fill="#3D394D"/>
                </svg>
                <h1 class="text-2xl font-bold m-0 text-gray-700">Reframer <span>v1.0.0</span></h1>
            </div>
            
            <!-- Video preview container -->
            <div id="videoPreview" class="flex-1 flex flex-col">
                <div class="bg-stone-900 p-8 rounded-lg flex-1 flex flex-col">
                    <!-- Video tabs navigation -->
                    <div class="border-b border-gray-700 mb-4">
                        <nav class="flex" aria-label="Video Tabs">
                            <button class="video-tab-button flex-1 py-2 px-4 border-b-2 border-blue-500 font-medium text-sm text-blue-400 text-center" data-tab="input">
                                Input Video
                            </button>
                            <button class="video-tab-button flex-1 py-2 px-4 border-b-2 border-transparent font-medium text-sm text-gray-400 hover:text-gray-300 hover:border-gray-600 text-center" data-tab="output">
                                Output Video
                            </button>
                        </nav>
                    </div>

                    <!-- Video tab content -->
                    <div class="video-tab-content flex-1 flex flex-col">
                        <!-- Input video tab -->
                        <div id="input-video-tab" class="video-tab-pane flex-1 flex flex-col">
                            <div class="relative bg-black rounded-lg overflow-hidden group flex-1" style="aspect-ratio: 16/9;">
                                <div class="absolute inset-0"></div>
                                <video id="previewVideo" class="w-full h-full object-contain hidden" preload="metadata" controls>
                                    Your browser does not support the video tag.
                                </video>
                                <button id="playPauseOverlay" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer hidden rounded-full hover:bg-opacity-40">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            </div>
                            <div id="videoInfo" class="mt-2 bg-gray-100 rounded-lg p-2 text-sm text-gray-700 font-mono hidden">
                                <span id="videoResolution"></span>
                                <span class="mx-2">•</span>
                                <span id="videoFps"></span>
                                <span class="mx-2">•</span>
                                <span id="videoDuration"></span>
                                <span class="mx-2">•</span>
                                <span id="videoSize"></span>
                            </div>
                        </div>

                        <!-- Output video tab -->
                        <div id="output-video-tab" class="video-tab-pane hidden flex-1 flex flex-col">
                            <div class="relative bg-black rounded-lg overflow-hidden group flex-1" style="aspect-ratio: 16/9;">
                                <div class="absolute inset-0"></div>
                                <video id="outputVideo" class="w-full h-full object-contain hidden" preload="metadata" controls>
                                    Your browser does not support the video tag.
                                </video>
                                <button id="outputPlayPauseOverlay" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer hidden rounded-full hover:bg-opacity-40">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            </div>
                            <div id="outputVideoInfo" class="mt-2 bg-gray-100 rounded-lg p-2 text-sm text-gray-700 font-mono hidden">
                                <span id="outputVideoResolution"></span>
                                <span class="mx-2">•</span>
                                <span id="outputVideoFps"></span>
                                <span class="mx-2">•</span>
                                <span id="outputVideoDuration"></span>
                                <span class="mx-2">•</span>
                                <span id="outputVideoSize"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right side: Settings panel -->
        <div class="w-1/3 h-full bg-white border-l border-gray-200 flex flex-col">
            <!-- Status notification -->
            <div id="status" class="hidden p-2.5 border-b border-gray-200"></div>

            <!-- File selection section -->
            <div class="p-5 border-b border-gray-200">
                <!-- Input type tabs -->
                <div class="border-b border-gray-200 mb-4">
                    <nav class="flex" aria-label="Input Type Tabs">
                        <button class="input-type-tab-button flex-1 py-2 px-4 border-b-2 border-blue-500 font-medium text-sm text-blue-600 text-center" data-tab="single">
                            Single Video
                        </button>
                        <button class="input-type-tab-button flex-1 py-2 px-4 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="batch">
                            Batch Processing
                        </button>
                    </nav>
                </div>

                <!-- Input type content -->
                <div class="input-type-content">
                    <!-- Single video input -->
                    <div id="single-input-tab" class="input-type-pane">
                        <div class="space-y-2.5">
                            <div class="flex items-center gap-2.5">
                                <input type="text" id="filePath" readonly placeholder="Select a video file..." class="flex-grow px-2 py-2 border border-gray-300 rounded bg-gray-50">
                                <button id="selectFile" class="btn btn-primary">Browse</button>
                            </div>
                            <div class="flex items-center gap-2.5">
                                <input type="text" id="outputDir" readonly placeholder="Select output directory..." class="flex-grow px-2 py-2 border border-gray-300 rounded bg-gray-50">
                                <button id="selectOutputDir" class="btn btn-primary">Browse</button>
                            </div>
                            <div class="flex items-center gap-2.5">
                                <label for="outputFilename" class="min-w-[150px] font-medium">Output Filename:</label>
                                <input type="text" id="outputFilename" placeholder="Enter output filename (without extension)" class="input flex-grow">
                                <span class="text-sm text-gray-600 italic">(Optional)</span>
                            </div>
                            <div class="flex gap-2.5">
                                <button id="processButton" disabled class="btn btn-run flex-grow disabled:bg-gray-300 disabled:cursor-not-allowed">Process Video</button>
                                <button id="cancelButton" class="btn btn-secondary hidden">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Batch processing input -->
                    <div id="batch-input-tab" class="input-type-pane hidden">
                        <!-- Batch progress header -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-semibold">Batch Progress</h3>
                                <div class="flex items-center gap-2">
                                    <button id="startBatch" class="btn btn-primary" disabled>Start Batch</button>
                                    <button id="pauseBatch" class="btn btn-secondary hidden">Pause</button>
                                    <button id="clearBatch" class="btn btn-secondary">Clear Queue</button>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex-1">
                                    <div class="text-sm text-gray-600 mb-1">Overall Progress</div>
                                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div id="batchProgressBar" class="h-full bg-blue-500 transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <span id="batchProgressText">0/0 videos</span>
                                </div>
                            </div>
                        </div>

                        <!-- File selection controls -->
                        <div class="flex gap-2.5 mb-4">
                            <button id="selectBatchFiles" class="btn btn-primary flex-1">Select Multiple Files</button>
                            <button id="selectBatchFolder" class="btn btn-primary flex-1">Select Folder</button>
                            <div class="flex items-center gap-2 px-3 bg-gray-50 rounded border border-gray-200">
                                <label class="toggle-button" for="recursiveSearch">
                                    <input type="checkbox" id="recursiveSearch" class="m-0">
                                    <svg><use href="#recursive-search-icon"></use></svg>
                                </label>
                                <label for="recursiveSearch" class="text-sm text-gray-600 cursor-pointer">Search subfolders</label>
                            </div>
                        </div>

                        <!-- Queue list -->
                        <div id="batchQueue" class="space-y-2 max-h-[200px] overflow-y-auto">
                            <!-- Queue items will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings section -->
            <div class="flex-1 overflow-y-auto">
                <div class="p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold">Processing Settings</h2>
                    </div>
                    
                    <!-- Tabs navigation -->
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="flex justify-between" aria-label="Settings Tabs">
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600 text-center" data-tab="basic">
                                Basic
                            </button>
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="detection">
                                Detection
                            </button>
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="crop">
                                Cropping
                            </button>
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="features">
                                Features
                            </button>
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="smoothing">
                                Smoothing
                            </button>
                            <button class="tab-button flex-1 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 text-center" data-tab="debug">
                                Debug
                            </button>
                        </nav>
                    </div>

                    <!-- Tab content -->
                    <div class="tab-content">
                        <!-- Basic Settings Tab -->
                        <div id="basic-tab" class="tab-pane">
                            <div class="space-y-2.5">
                                <div class="flex items-center gap-2.5">
                                    <label for="targetRatio" class="min-w-[150px] font-medium">Target Aspect Ratio:</label>
                                    <div class="flex items-center gap-2">
                                        <div class="bg-gradient-to-br from-[#CFCEDC] to-[#D4D2E0] rounded-md p-2 flex flex-col gap-2">
                                            <svg class="w-4 h-4 fill-black m-auto"><use href="#aspect-ratio"></use></svg>
                                            <x-knob svgsymbolid="simpleknob-orange" id="aspectRatioDial" min="-2.0" max="2.0" step="0.01" value="0.75" style="width:40px;height:40px;outline:none;"></x-knob>
                                        </div>
                                        <input type="number" id="targetRatio" value="0.75" step="0.01" min="-2.0" max="2.0" class="input w-48" style="font-size: 3.0rem;">
                                    </div>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="min-w-[150px] font-medium">Preset Ratios:</label>
                                    <div class="flex items-center gap-2 flex-wrap">
                                        <button class="aspect-ratio-preset" data-ratio="1.0" title="Square (1:1)">
                                            <svg class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"><use href="#square-ratio"></use></svg>
                                            <span class="text-xs mt-1">Square</span>
                                        </button>
                                        <button class="aspect-ratio-preset" data-ratio="0.8" title="Portrait (4:5)">
                                            <svg class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"><use href="#portrait-ratio"></use></svg>
                                            <span class="text-xs mt-1">Portrait</span>
                                        </button>
                                        <button class="aspect-ratio-preset" data-ratio="0.5625" title="Vertical (9:16)">
                                            <svg class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"><use href="#vertical-ratio"></use></svg>
                                            <span class="text-xs mt-1">Vertical</span>
                                        </button>
                                        <button class="aspect-ratio-preset" data-ratio="1.91" title="Landscape (21:11)">
                                            <svg class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"><use href="#landscape-ratio"></use></svg>
                                            <span class="text-xs mt-1">Landscape</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="min-w-[150px] font-medium">Calculate Ratio:</label>
                                    <div class="flex items-center gap-3 bg-gray-50 p-2 rounded border border-gray-200">
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="widthInput" placeholder="Width" class="input w-28 bg-white" min="1">
                                            <span class="text-gray-600 font-medium">x</span>
                                            <input type="number" id="heightInput" placeholder="Height" class="input w-28 bg-white" min="1">
                                        </div>
                                        <button id="calculateRatio" class="btn btn-secondary text-sm px-4 ml-2">Calculate</button>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-2.5">
                                    <label for="maxWorkers" class="min-w-[150px] font-medium">Max Workers:</label>
                                    <input type="number" id="maxWorkers" value="6" min="1" max="32" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Number of CPU cores to use)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Detection Settings Tab -->
                        <div id="detection-tab" class="tab-pane hidden">
                            <div class="space-y-2.5">
                                <div class="flex items-center gap-2.5">
                                    <label for="skipFrames" class="min-w-[150px] font-medium">Skip Frames:</label>
                                    <input type="number" id="skipFrames" value="10" min="0" max="100" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Process every Nth frame)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="confThreshold" class="min-w-[150px] font-medium">Confidence:</label>
                                    <input type="number" id="confThreshold" value="0.4" step="0.1" min="0.1" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(0.0 to 1.0)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="modelSize" class="min-w-[150px] font-medium">Model Size:</label>
                                    <div class="flex gap-2">
                                        <button type="button" class="model-size-btn px-3 py-2 border rounded cursor-pointer transition-colors flex items-center gap-2" data-value="n">
                                            <svg class="w-5 h-5"><use href="#model-nano"></use></svg>
                                            <span class="text-sm">Nano</span>
                                            <span class="text-xs text-gray-500">(Fastest)</span>
                                        </button>
                                        <button type="button" class="model-size-btn px-3 py-2 border rounded cursor-pointer transition-colors flex items-center gap-2" data-value="s">
                                            <svg class="w-5 h-5"><use href="#model-small"></use></svg>
                                            <span class="text-sm">Small</span>
                                        </button>
                                        <button type="button" class="model-size-btn px-3 py-2 border rounded cursor-pointer transition-colors flex items-center gap-2" data-value="m">
                                            <svg class="w-5 h-5"><use href="#model-medium"></use></svg>
                                            <span class="text-sm">Medium</span>
                                        </button>
                                        <button type="button" class="model-size-btn px-3 py-2 border rounded cursor-pointer transition-colors flex items-center gap-2" data-value="l">
                                            <svg class="w-5 h-5"><use href="#model-large"></use></svg>
                                            <span class="text-sm">Large</span>
                                        </button>
                                        <button type="button" class="model-size-btn px-3 py-2 border rounded cursor-pointer transition-colors flex items-center gap-2" data-value="x">
                                            <svg class="w-5 h-5"><use href="#model-xlarge"></use></svg>
                                            <span class="text-sm">XLarge</span>
                                            <span class="text-xs text-gray-500">(Most Accurate)</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="objectClasses" class="min-w-[150px] font-medium">Object Classes:</label>
                                    <div class="flex-1">
                                        <div id="objectClassesGrid">
                                            <!-- Object class toggle buttons will be generated here -->
                                        </div>
                                        <div class="flex gap-2 mt-2">
                                            <button type="button" id="selectAllClasses" class="px-2 py-1 text-xs bg-blue-500 text-white border-none rounded cursor-pointer hover:bg-blue-600">Select All</button>
                                            <button type="button" id="deselectAllClasses" class="px-2 py-1 text-xs bg-gray-500 text-white border-none rounded cursor-pointer hover:bg-gray-600">Deselect All</button>
                                            <button type="button" id="selectCommonClasses" class="px-2 py-1 text-xs bg-green-500 text-white border-none rounded cursor-pointer hover:bg-green-600">Common Objects</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="trackCount" class="min-w-[150px] font-medium">Track Count:</label>
                                    <input type="number" id="trackCount" value="1" min="1" max="10" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Number of objects to track)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Crop Settings Tab -->
                        <div id="crop-tab" class="tab-pane hidden">
                            <div class="space-y-2.5">
                                <div class="flex items-center gap-2.5">
                                    <label for="paddingRatio" class="min-w-[150px] font-medium">Padding Ratio:</label>
                                    <input type="number" id="paddingRatio" value="0.1" step="0.01" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Space around detected objects)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="sizeWeight" class="min-w-[150px] font-medium">Size Weight:</label>
                                    <input type="number" id="sizeWeight" value="0.4" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Importance of object size)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="centerWeight" class="min-w-[150px] font-medium">Center Weight:</label>
                                    <input type="number" id="centerWeight" value="0.3" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Importance of center position)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="motionWeight" class="min-w-[150px] font-medium">Motion Weight:</label>
                                    <input type="number" id="motionWeight" value="0.3" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Importance of object motion)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="historyWeight" class="min-w-[150px] font-medium">History Weight:</label>
                                    <input type="number" id="historyWeight" value="0.1" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Importance of object history)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="saliencyWeight" class="min-w-[150px] font-medium">Saliency Weight:</label>
                                    <input type="number" id="saliencyWeight" value="0.4" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Importance of visual saliency)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Feature Toggles Tab -->
                        <div id="features-tab" class="tab-pane hidden">
                            <div class="space-y-1.5">
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="faceDetection">
                                        <input type="checkbox" id="faceDetection" class="m-0">
                                        <svg><use href="#face-detection-icon"></use></svg>
                                    </label>
                                    <label for="faceDetection" class="ml-1.5 cursor-pointer">Face Detection</label>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="weightedCenter">
                                        <input type="checkbox" id="weightedCenter" class="m-0">
                                        <svg><use href="#weighted-center-icon"></use></svg>
                                    </label>
                                    <label for="weightedCenter" class="ml-1.5 cursor-pointer">Weighted Center</label>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="blendSaliency">
                                        <input type="checkbox" id="blendSaliency" class="m-0">
                                        <svg><use href="#blend-saliency-icon"></use></svg>
                                    </label>
                                    <label for="blendSaliency" class="ml-1.5 cursor-pointer">Blend Saliency</label>
                                </div>
                            </div>
                        </div>

                        <!-- Smoothing Settings Tab -->
                        <div id="smoothing-tab" class="tab-pane hidden">
                            <div class="space-y-2.5">
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="applySmoothing">
                                        <input type="checkbox" id="applySmoothing" checked class="m-0">
                                        <svg><use href="#smoothing-icon"></use></svg>
                                    </label>
                                    <label for="applySmoothing" class="ml-1.5 cursor-pointer">Apply Temporal Smoothing</label>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="smoothingWindow" class="min-w-[150px] font-medium">Smoothing Window:</label>
                                    <input type="number" id="smoothingWindow" value="30" min="1" max="100" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(Frames for smoothing)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="positionInertia" class="min-w-[150px] font-medium">Position Inertia:</label>
                                    <input type="number" id="positionInertia" value="0.8" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(How much position sticks to previous frame)</span>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label for="sizeInertia" class="min-w-[150px] font-medium">Size Inertia:</label>
                                    <input type="number" id="sizeInertia" value="0.9" step="0.1" min="0" max="1.0" class="input w-24">
                                    <span class="text-sm text-gray-600 italic">(How much size sticks to previous frame)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Debug Tab -->
                        <div id="debug-tab" class="tab-pane hidden">
                            <div class="space-y-1.5">
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="debugMode">
                                        <input type="checkbox" id="debugMode" class="m-0">
                                        <svg><use href="#debug-icon"></use></svg>
                                    </label>
                                    <label for="debugMode" class="ml-1.5 cursor-pointer">Debug Mode (Create Debug Video)</label>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="debugWindow">
                                        <input type="checkbox" id="debugWindow" class="m-0">
                                        <svg><use href="#debug-icon"></use></svg>
                                    </label>
                                    <label for="debugWindow" class="ml-1.5 cursor-pointer">Show Debug Window</label>
                                </div>
                                <div class="flex items-center gap-2.5">
                                    <label class="toggle-button" for="showHelp">
                                        <input type="checkbox" id="showHelp" class="m-0">
                                        <svg><use href="#help-icon"></use></svg>
                                    </label>
                                    <label for="showHelp" class="ml-1.5 cursor-pointer">Show Help Messages</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug panel (collapsible) -->
            <div class="debug-panel hidden border-t border-gray-200">
                <div class="flex justify-between items-center p-2.5 bg-[#2d2d2d] border-b border-gray-200">
                    <h3 class="m-0 text-white text-base">Python Output</h3>
                    <div class="flex items-center gap-2">
                        <button id="toggleDebug" class="px-2 py-1 bg-[#444] text-white border-none rounded cursor-pointer text-sm hover:bg-[#555]">Collapse</button>
                        <button id="clearDebug" class="px-2 py-1 bg-[#444] text-white border-none rounded cursor-pointer text-sm hover:bg-[#555]">Clear</button>
                    </div>
                </div>
                <pre id="debugOutput" class="m-0 p-4 max-h-[200px] overflow-y-auto whitespace-pre-wrap break-words text-sm leading-relaxed bg-[#1e1e1e] text-[#d4d4d4] font-mono"></pre>
            </div>
        </div>
    </div>

    <script>
        const selectFileButton = document.getElementById('selectFile');
        const selectOutputDirButton = document.getElementById('selectOutputDir');
        const processButton = document.getElementById('processButton');
        const filePathInput = document.getElementById('filePath');
        const outputDirInput = document.getElementById('outputDir');
        const outputFilenameInput = document.getElementById('outputFilename');
        const statusDiv = document.getElementById('status');
        const cancelButton = document.getElementById('cancelButton');
        let currentProcess = null;

        function showStatus(message, type) {
            statusDiv.innerHTML = message.replace(/\n/g, '<br>');
            statusDiv.classList.remove('hidden');
            statusDiv.className = `p-2.5 border-b border-gray-200 ${
                type === 'success' ? 'bg-green-50 text-green-800' : 
                type === 'error' ? 'bg-red-50 text-red-800' : 
                'bg-yellow-50 text-yellow-800'
            }`;
        }

        // Helper function to calculate FPS
        function calculateFPS(video) {
            // Try to get FPS from video metadata
            if (video.mozFrameRate) {
                // Firefox
                return video.mozFrameRate;
            }
            
            // Try to get FPS from video track
            const videoTrack = video.videoTracks?.[0];
            if (videoTrack?.getSettings?.()?.frameRate) {
                return videoTrack.getSettings().frameRate;
            }
            
            // Try to get FPS from webkit properties
            if (video.webkitVideoDecodedByteCount && video.duration) {
                // This is a rough estimate based on decoded bytes
                const bytesPerFrame = video.videoWidth * video.videoHeight * 1.5; // Assuming YUV420 format
                const totalFrames = video.webkitVideoDecodedByteCount / bytesPerFrame;
                return totalFrames / video.duration;
            }
            
            // Default to 30fps if we can't determine
            return 30;
        }

        // Update video preview functionality
        async function updateVideoPreview(videoPath) {
            const previewVideo = document.getElementById('previewVideo');
            const videoResolution = document.getElementById('videoResolution');
            const videoDuration = document.getElementById('videoDuration');
            const videoFps = document.getElementById('videoFps');
            const videoSize = document.getElementById('videoSize');
            const playPauseOverlay = document.getElementById('playPauseOverlay');

            try {
                // Create a File object from the path
                const response = await fetch(`file://${videoPath}`);
                const blob = await response.blob();
                const file = new File([blob], videoPath.split('/').pop(), { type: blob.type });
                
                // Create object URL for the video
                const videoUrl = URL.createObjectURL(file);
                previewVideo.src = videoUrl;
                
                // Show video element and play/pause overlay
                previewVideo.classList.remove('hidden');
                playPauseOverlay.classList.remove('hidden');
                
                // Wait for metadata to load
                await new Promise((resolve) => {
                    previewVideo.onloadedmetadata = () => {
                        // Show video info panel
                        document.getElementById('videoInfo').classList.remove('hidden');
                        
                        // Update video info
                        videoResolution.textContent = `${previewVideo.videoWidth}×${previewVideo.videoHeight}`;
                        
                        // Format duration as minutes:seconds
                        const minutes = Math.floor(previewVideo.duration / 60);
                        const seconds = Math.floor(previewVideo.duration % 60);
                        videoDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Calculate FPS
                        let fps = calculateFPS(previewVideo);
                        // Round to nearest standard frame rate
                        const standardRates = [23.976, 24, 25, 29.97, 30, 50, 59.94, 60];
                        const closest = standardRates.reduce((prev, curr) => {
                            return Math.abs(curr - fps) < Math.abs(prev - fps) ? curr : prev;
                        });
                        fps = closest;
                        videoFps.textContent = `${fps.toFixed(2)} fps`;
                        
                        // Format size with more precision
                        const sizeMB = file.size / (1024 * 1024);
                        videoSize.textContent = sizeMB >= 1000 
                            ? `${(sizeMB / 1024).toFixed(2)} GB`
                            : `${sizeMB.toFixed(2)} MB`;
                        
                        resolve();
                    };
                });

                // Add play/pause overlay functionality
                playPauseOverlay.addEventListener('click', async () => {
                    try {
                        if (previewVideo.paused) {
                            await previewVideo.play();
                            playPauseOverlay.querySelector('svg').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                        } else {
                            previewVideo.pause();
                            playPauseOverlay.querySelector('svg').innerHTML = '<path d="M8 5v14l11-7z"/>';
                        }
                    } catch (error) {
                        console.error('Error playing video:', error);
                    }
                });

                // Update overlay button when video plays/pauses
                previewVideo.addEventListener('play', () => {
                    playPauseOverlay.querySelector('svg').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                });
                previewVideo.addEventListener('pause', () => {
                    playPauseOverlay.querySelector('svg').innerHTML = '<path d="M8 5v14l11-7z"/>';
                });
                
                // Clean up object URL when video is unloaded
                previewVideo.onunload = () => {
                    URL.revokeObjectURL(videoUrl);
                    previewVideo.classList.add('hidden');
                    playPauseOverlay.classList.add('hidden');
                    document.getElementById('videoInfo').classList.add('hidden');
                };
            } catch (error) {
                console.error('Error updating video preview:', error);
                previewVideo.classList.add('hidden');
                playPauseOverlay.classList.add('hidden');
                document.getElementById('videoInfo').classList.add('hidden');
            }
        }

        // Update file selection handler
        selectFileButton.addEventListener('click', async () => {
            const filePath = await window.electronAPI.selectFile();
            if (filePath) {
                filePathInput.value = filePath;
                // Set default output directory to same as input file
                const defaultOutputDir = filePath.substring(0, filePath.lastIndexOf('/'));
                outputDirInput.value = defaultOutputDir;
                await updateVideoPreview(filePath);
                processButton.disabled = false;
            }
        });

        selectOutputDirButton.addEventListener('click', async () => {
            const dirPath = await window.electronAPI.selectDirectory();
            if (dirPath) {
                outputDirInput.value = dirPath;
            }
        });

        // Add event listeners for all settings
        const settings = {
            targetRatio: document.getElementById('targetRatio'),
            maxWorkers: document.getElementById('maxWorkers'),
            skipFrames: document.getElementById('skipFrames'),
            confThreshold: document.getElementById('confThreshold'),
            trackCount: document.getElementById('trackCount'),
            paddingRatio: document.getElementById('paddingRatio'),
            sizeWeight: document.getElementById('sizeWeight'),
            centerWeight: document.getElementById('centerWeight'),
            motionWeight: document.getElementById('motionWeight'),
            historyWeight: document.getElementById('historyWeight'),
            saliencyWeight: document.getElementById('saliencyWeight'),
            faceDetection: document.getElementById('faceDetection'),
            weightedCenter: document.getElementById('weightedCenter'),
            blendSaliency: document.getElementById('blendSaliency'),
            applySmoothing: document.getElementById('applySmoothing'),
            smoothingWindow: document.getElementById('smoothingWindow'),
            positionInertia: document.getElementById('positionInertia'),
            sizeInertia: document.getElementById('sizeInertia'),
            debugMode: document.getElementById('debugMode'),
            debugWindow: document.getElementById('debugWindow'),
            showHelp: document.getElementById('showHelp'),
            recursiveSearch: document.getElementById('recursiveSearch'),
            // Model size getter for button-based selection
            get modelSize() {
                const selectedButton = document.querySelector('.model-size-btn.selected');
                const value = selectedButton ? selectedButton.dataset.value : 'x'; // Default to XLarge
                console.log('Getting model size:', value, 'from button:', selectedButton);
                return value;
            }
        };

        const debugPanel = document.querySelector('.debug-panel');
        const debugOutput = document.getElementById('debugOutput');
        const toggleDebugButton = document.getElementById('toggleDebug');
        let isDebugExpanded = true;

        toggleDebugButton.addEventListener('click', () => {
            isDebugExpanded = !isDebugExpanded;
            debugOutput.style.display = isDebugExpanded ? 'block' : 'none';
            toggleDebugButton.textContent = isDebugExpanded ? 'Collapse' : 'Expand';
        });

        // Update debug panel visibility when debug mode is toggled
        settings.debugMode.addEventListener('change', (e) => {
            // This now only controls debug mode for the Python script (debug video creation)
            // The debug window visibility is controlled by debugWindow button
        });

        // Update debug panel visibility when debug window is toggled
        settings.debugWindow.addEventListener('change', (e) => {
            const debugPanel = document.querySelector('.debug-panel');
            const debugOutput = document.getElementById('debugOutput');
            const toggleDebugButton = document.getElementById('toggleDebug');
            
            debugPanel.classList.toggle('hidden', !e.target.checked);
            if (e.target.checked) {
                isDebugExpanded = true;
                debugOutput.style.display = 'block';
                toggleDebugButton.textContent = 'Collapse';
                // Show debug panel immediately when enabled
                debugPanel.classList.remove('hidden');
            }
        });

        // Add clear debug button event listener
        document.getElementById('clearDebug').addEventListener('click', () => {
            clearDebugOutput();
        });

        // Global variable to track current Python handlers
        let currentPythonHandlers = null;
        let isProcessing = false;

        // Function to clean up Python output handlers
        function cleanupPythonHandlers() {
            if (currentPythonHandlers) {
                // Call the cleanup functions returned by the API
                if (currentPythonHandlers.cleanupOutput) {
                    currentPythonHandlers.cleanupOutput();
                }
                if (currentPythonHandlers.cleanupComplete) {
                    currentPythonHandlers.cleanupComplete();
                }
                currentPythonHandlers = null;
            }
            isProcessing = false;
        }

        // Function to set up Python output handlers
        function setupPythonHandlers() {
            // Clean up any existing handlers first
            cleanupPythonHandlers();
            
            // Set up new handlers
            isProcessing = true;
            
            const pythonOutputHandler = (event, message) => {
                if (isProcessing) {  // Only append output if we're still processing
                    appendDebugOutput(message, 'info');
                }
            };
            
            const scriptCompleteHandler = (event, result) => {
                // Clean up handlers immediately when script completes
                cleanupPythonHandlers();
                
                if (result.success) {
                    showStatus(`Video processing completed successfully!\nOutput saved to: ${result.outputPath}`, 'success');
                    appendDebugOutput('Processing completed successfully!', 'success');
                    appendDebugOutput(`Output saved to: ${result.outputPath}`, 'success');
                    
                    // If in single video mode, load the output video
                    if (!isBatchProcessing) {
                        loadOutputVideo(result.outputPath).then(() => {
                            switchVideoTab('output');
                        });
                    } else {
                        // Update batch queue item status
                        const video = batchQueue[currentBatchIndex];
                        if (video) {
                            video.status = 'completed';
                            video.progress = 100;
                            updateQueueItemStatus(video.path, 'completed', 100);
                            updateBatchProgress();
                        }
                    }
                } else {
                    showStatus(`Error: ${result.error}`, 'error');
                    appendDebugOutput(`Error: ${result.error}`, 'error');
                    if (result.stack) {
                        appendDebugOutput(result.stack, 'error');
                    }
                    
                    // If in batch mode, update queue item status
                    if (isBatchProcessing) {
                        const video = batchQueue[currentBatchIndex];
                        if (video) {
                            video.status = 'failed';
                            updateQueueItemStatus(video.path, 'failed', 0, result.error);
                            updateBatchProgress();
                        }
                    }
                }

                // Reset UI state if in single video mode
                if (!isBatchProcessing) {
                    processButton.classList.remove('hidden');
                    cancelButton.classList.add('hidden');
                    processButton.disabled = false;
                    selectFileButton.disabled = false;
                    selectOutputDirButton.disabled = false;
                    outputFilenameInput.disabled = false;
                    currentProcess = null;
                } else {
                    // Process next video in batch if not paused
                    if (isBatchProcessing) {
                        processNextVideo();
                    }
                }
            };

            // Set up new handlers and store cleanup functions
            const cleanupOutput = window.electronAPI.onPythonOutput(pythonOutputHandler);
            const cleanupComplete = window.electronAPI.onPythonScriptComplete(scriptCompleteHandler);
            
            // Store current handlers and cleanup functions
            currentPythonHandlers = { 
                pythonOutputHandler, 
                scriptCompleteHandler,
                cleanupOutput,
                cleanupComplete
            };
        }

        // Add settings help text
        const settingsHelp = {
            targetRatio: "The desired aspect ratio for the output video. Common values: 0.75 (4:3), 0.5625 (16:9), 1.0 (1:1). The script will try to maintain this ratio while keeping important content in frame.",
            maxWorkers: "Number of CPU cores to use for parallel processing. Higher values may improve speed but will use more system resources. Recommended: 4-8 for most systems.",
            skipFrames: "Process every Nth frame to speed up processing. Higher values are faster but may miss rapid movements. Recommended: 5-15 for most videos.",
            confThreshold: "Minimum confidence score (0.0-1.0) required for object detection. Higher values are more selective but may miss objects. Lower values detect more objects but may include false positives.",
            modelSize: "Size of the YOLO model to use. Larger models are more accurate but slower. Options: Nano (fastest), Small, Medium, Large, XLarge (most accurate).",
            objectClasses: "Select which object classes to detect using the toggle buttons above. Click buttons to select/deselect objects. Use 'Select All', 'Deselect All', or 'Common Objects' for quick selection. Default is person only.",
            trackCount: "Maximum number of objects to track simultaneously. Higher values may improve tracking of multiple subjects but use more resources.",
            paddingRatio: "Additional space to add around detected objects (0.0-1.0). Higher values give more context but may include unwanted areas.",
            sizeWeight: "Importance of object size in crop decisions (0.0-1.0). Higher values prioritize keeping objects large in frame.",
            centerWeight: "Importance of object position in crop decisions (0.0-1.0). Higher values try to keep objects centered.",
            motionWeight: "Importance of object movement in crop decisions (0.0-1.0). Higher values prioritize tracking moving objects.",
            historyWeight: "Importance of previous frame positions (0.0-1.0). Higher values make cropping more stable but less responsive to movement.",
            saliencyWeight: "Importance of visual saliency in crop decisions (0.0-1.0). Higher values try to keep visually interesting areas in frame.",
            faceDetection: "Enable additional face detection to prioritize keeping faces in frame. Useful for videos with people. However, it can cause issues with tracking correctly.",
            weightedCenter: "Use weighted center calculation based on object size and position. Helps balance the frame when there are multiple subjects.",
            blendSaliency: "Blend saliency map with object detection for better composition. May help keep visually important areas in frame.",
            applySmoothing: "Apply temporal smoothing to crop window movement. Reduces jitter but may make tracking less responsive.",
            smoothingWindow: "Number of frames to use for smoothing (1-100). Higher values make movement smoother but may lag behind rapid changes.",
            positionInertia: "How much the crop position sticks to previous frames (0.0-1.0). Higher values reduce jitter but may lag behind movement.",
            sizeInertia: "How much the crop size sticks to previous frames (0.0-1.0). Higher values make size changes smoother but may lag behind.",
            debugMode: "Enable debug mode in the Python script to create a debug video with detection boxes. This will generate a video file showing object detection results.",
            debugWindow: "Show the debug window in the GUI to display real-time processing output and logs.",
            showHelp: "Show help messages in the GUI to guide the user through the process.",
            recursiveSearch: "Search subfolders for video files. This can be useful for organizing large video collections."
        };

        // Add help text to settings
        function addHelpTextToSettings() {
            // Get all setting elements
            const settingElements = {
                targetRatio: document.getElementById('targetRatio'),
                maxWorkers: document.getElementById('maxWorkers'),
                skipFrames: document.getElementById('skipFrames'),
                confThreshold: document.getElementById('confThreshold'),
                modelSize: document.getElementById('modelSize'),
                trackCount: document.getElementById('trackCount'),
                paddingRatio: document.getElementById('paddingRatio'),
                sizeWeight: document.getElementById('sizeWeight'),
                centerWeight: document.getElementById('centerWeight'),
                motionWeight: document.getElementById('motionWeight'),
                historyWeight: document.getElementById('historyWeight'),
                saliencyWeight: document.getElementById('saliencyWeight'),
                faceDetection: document.getElementById('faceDetection'),
                weightedCenter: document.getElementById('weightedCenter'),
                blendSaliency: document.getElementById('blendSaliency'),
                applySmoothing: document.getElementById('applySmoothing'),
                smoothingWindow: document.getElementById('smoothingWindow'),
                positionInertia: document.getElementById('positionInertia'),
                sizeInertia: document.getElementById('sizeInertia')
            };

            // Add help text elements and toggle visibility
            Object.entries(settingElements).forEach(([key, element]) => {
                if (!element) return;

                // Find the parent container (usually a div with flex items-center gap-2.5)
                const container = element.closest('.flex.items-center.gap-2\\.5');
                if (!container) return;

                // Create help text element
                const helpText = document.createElement('div');
                helpText.className = 'help-text text-sm text-gray-600 mt-1 ml-[150px] hidden';
                helpText.textContent = settingsHelp[key];
                helpText.id = `${key}-help`;

                // Insert help text after the container
                container.parentNode.insertBefore(helpText, container.nextSibling);
            });

            // Special handling for object classes (new toggle button system)
            const objectClassesContainer = document.querySelector('label[for="objectClasses"]').closest('.flex.items-center.gap-2\\.5');
            if (objectClassesContainer) {
                const helpText = document.createElement('div');
                helpText.className = 'help-text text-sm text-gray-600 mt-1 ml-[150px] hidden';
                helpText.textContent = settingsHelp.objectClasses;
                helpText.id = 'objectClasses-help';

                // Insert help text after the container
                objectClassesContainer.parentNode.insertBefore(helpText, objectClassesContainer.nextSibling);
            }
        }

        // Function to toggle help text visibility
        function toggleHelpText(show) {
            const helpTexts = document.querySelectorAll('.help-text');
            helpTexts.forEach(help => {
                help.classList.toggle('hidden', !show);
            });
        }

        // Add help text toggle handler
        document.getElementById('showHelp').addEventListener('change', (e) => {
            toggleHelpText(e.target.checked);
        });

        // Initialize help text system
        addHelpTextToSettings();

        // Update logSettingsToDebug to include help text when enabled
        function logSettingsToDebug(options) {
            appendDebugOutput('Processing Settings:', 'info');
            appendDebugOutput('-------------------', 'info');
            
            // Log all settings in a readable format
            const settings = [
                ['Input Video', options.input_path],
                ['Output Directory', options.output_dir],
                ['Output Filename', options.output_filename || '(auto-generated)'],
                ['Target Aspect Ratio', options.target_ratio],
                ['Max Workers', options.max_workers],
                ['Detector Model', options.detector],
                ['Skip Frames', options.skip_frames],
                ['Confidence Threshold', options.conf_threshold],
                ['Model Size', options.model_size],
                ['Object Classes', options.object_classes.join(', ')],
                ['Track Count', options.track_count],
                ['Padding Ratio', options.padding_ratio],
                ['Size Weight', options.size_weight],
                ['Center Weight', options.center_weight],
                ['Motion Weight', options.motion_weight],
                ['History Weight', options.history_weight],
                ['Saliency Weight', options.saliency_weight],
                ['Face Detection', options.face_detection ? 'Enabled' : 'Disabled'],
                ['Weighted Center', options.weighted_center ? 'Enabled' : 'Disabled'],
                ['Blend Saliency', options.blend_saliency ? 'Enabled' : 'Disabled'],
                ['Apply Smoothing', options.apply_smoothing ? 'Enabled' : 'Disabled'],
                ['Smoothing Window', options.smoothing_window],
                ['Position Inertia', options.position_inertia],
                ['Size Inertia', options.size_inertia],
                ['Debug Mode', options.debug ? 'Enabled' : 'Disabled'],
                ['Debug Window', options.debug_window ? 'Enabled' : 'Disabled'],
                ['Show Help', options.show_help ? 'Enabled' : 'Disabled'],
                ['Recursive Search', options.recursive_search ? 'Enabled' : 'Disabled']
            ];

            // Find the longest label for alignment
            const maxLabelLength = Math.max(...settings.map(([label]) => label.length));
            
            // Log each setting with aligned labels and help text if enabled
            settings.forEach(([label, value]) => {
                const paddedLabel = label.padEnd(maxLabelLength);
                appendDebugOutput(`${paddedLabel}: ${value}`, 'info');
                
                // Add help text if showHelp is enabled
                if (document.getElementById('showHelp').checked) {
                    const settingKey = label.toLowerCase().replace(/\s+/g, '');
                    if (settingsHelp[settingKey]) {
                        appendDebugOutput(`    ${settingsHelp[settingKey]}`, 'info');
                    }
                }
            });
            
            appendDebugOutput('-------------------', 'info');
            appendDebugOutput('Starting processing...', 'info');
            appendDebugOutput('', 'info'); // Add a blank line for readability
        }

        // Update process button click handler
        processButton.addEventListener('click', async () => {
            const videoPath = filePathInput.value;
            const outputDir = outputDirInput.value;
            const outputFilename = outputFilenameInput.value.trim();
            
            if (!videoPath || !outputDir) return;

            // Clean up any existing handlers before starting new process
            cleanupPythonHandlers();

            // Show cancel button and hide process button
            processButton.classList.add('hidden');
            cancelButton.classList.remove('hidden');
            
            // Disable all inputs
            processButton.disabled = true;
            selectFileButton.disabled = true;
            selectOutputDirButton.disabled = true;
            outputFilenameInput.disabled = true;
            
            showStatus('Processing video...', 'processing');
            clearDebugOutput();
            appendDebugOutput('Starting video processing...', 'info');

            try {
                // Set up handlers before starting process
                setupPythonHandlers();

                // Get selected object classes from toggle buttons
                const objectClassesArray = getSelectedObjectClasses();

                // Show debug panel if debug mode is enabled
                if (settings.debugMode.checked) {
                    const debugPanel = document.querySelector('.debug-panel');
                    debugPanel.classList.remove('hidden');
                    isDebugExpanded = true;
                    document.getElementById('debugOutput').style.display = 'block';
                    document.getElementById('toggleDebug').textContent = 'Collapse';
                }

                // Prepare options object
                const options = {
                    input_path: videoPath,
                    output_dir: outputDir,
                    output_filename: outputFilename,
                    target_ratio: parseFloat(settings.targetRatio.value),
                    max_workers: parseInt(settings.maxWorkers.value),
                    detector: 'yolo',
                    skip_frames: parseInt(settings.skipFrames.value),
                    conf_threshold: parseFloat(settings.confThreshold.value),
                    model_size: settings.modelSize,
                    object_classes: objectClassesArray,
                    track_count: parseInt(settings.trackCount.value),
                    padding_ratio: parseFloat(settings.paddingRatio.value),
                    size_weight: parseFloat(settings.sizeWeight.value),
                    center_weight: parseFloat(settings.centerWeight.value),
                    motion_weight: parseFloat(settings.motionWeight.value),
                    history_weight: parseFloat(settings.historyWeight.value),
                    saliency_weight: parseFloat(settings.saliencyWeight.value),
                    face_detection: settings.faceDetection.checked,
                    weighted_center: settings.weightedCenter.checked,
                    blend_saliency: settings.blendSaliency.checked,
                    apply_smoothing: settings.applySmoothing.checked,
                    smoothing_window: parseInt(settings.smoothingWindow.value),
                    position_inertia: parseFloat(settings.positionInertia.value),
                    size_inertia: parseFloat(settings.sizeInertia.value),
                    debug: settings.debugMode.checked,
                    debug_window: settings.debugWindow.checked,
                    show_help: settings.showHelp.checked,
                    recursive_search: settings.recursiveSearch.checked
                };

                // Log settings to debug window
                logSettingsToDebug(options);

                // Run the Python script
                currentProcess = await window.electronAPI.runPythonScript(videoPath, options);
            } catch (error) {
                // Clean up handlers on error
                cleanupPythonHandlers();

                if (error.code === 'PROCESS_CANCELLED') {
                    showStatus('Processing cancelled', 'error');
                    appendDebugOutput('Processing cancelled by user', 'error');
                } else {
                    const errorMessage = error.error || error.message || 'An unknown error occurred';
                    const errorDetails = error.stack ? `\n\nDetails: ${error.stack}` : '';
                    showStatus(`Error: ${errorMessage}${errorDetails}`, 'error');
                    appendDebugOutput(`Error: ${errorMessage}`, 'error');
                    if (error.stack) {
                        appendDebugOutput(error.stack, 'error');
                    }
                    console.error('Processing error:', error);
                }

                // Reset UI state
                processButton.classList.remove('hidden');
                cancelButton.classList.add('hidden');
                processButton.disabled = false;
                selectFileButton.disabled = false;
                selectOutputDirButton.disabled = false;
                outputFilenameInput.disabled = false;
                currentProcess = null;
            }
        });

        // Update cancel button handler
        cancelButton.addEventListener('click', async () => {
            appendDebugOutput('Cancelling processing...', 'info');
            try {
                // Clean up Python output handlers
                cleanupPythonHandlers();

                const result = await window.electronAPI.cancelProcessing();
                if (result.success) {
                    showStatus('Processing cancelled', 'error');
                    appendDebugOutput('Processing cancelled successfully', 'info');
                } else {
                    showStatus(`Failed to cancel: ${result.error}`, 'error');
                    appendDebugOutput(`Failed to cancel: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`Error cancelling: ${error.message}`, 'error');
                appendDebugOutput(`Error cancelling: ${error.message}`, 'error');
            }
        });

        // Add tab functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');

        function switchTab(tabId) {
            // Update tab buttons
            tabButtons.forEach(button => {
                if (button.dataset.tab === tabId) {
                    button.classList.add('border-blue-500', 'text-blue-600');
                    button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                } else {
                    button.classList.remove('border-blue-500', 'text-blue-600');
                    button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                }
            });

            // Update tab panes
            tabPanes.forEach(pane => {
                if (pane.id === `${tabId}-tab`) {
                    pane.classList.remove('hidden');
                } else {
                    pane.classList.add('hidden');
                }
            });
        }

        // Add click handlers for tabs
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchTab(button.dataset.tab);
            });
        });

        // Initialize with first tab
        switchTab('basic');

        // Update output video loading function
        async function loadOutputVideo(videoPath) {
            const outputVideo = document.getElementById('outputVideo');
            const outputResolution = document.getElementById('outputVideoResolution');
            const outputDuration = document.getElementById('outputVideoDuration');
            const outputFps = document.getElementById('outputVideoFps');
            const outputSize = document.getElementById('outputVideoSize');
            const outputPlayPauseOverlay = document.getElementById('outputPlayPauseOverlay');

            try {
                // Remove any existing event listeners
                const newPlayPauseOverlay = outputPlayPauseOverlay.cloneNode(true);
                outputPlayPauseOverlay.parentNode.replaceChild(newPlayPauseOverlay, outputPlayPauseOverlay);

                // Create a File object from the path
                const response = await fetch(`file://${videoPath}`);
                const blob = await response.blob();
                const file = new File([blob], videoPath.split('/').pop(), { type: blob.type });
                
                // Create object URL for the video
                const videoUrl = URL.createObjectURL(file);
                outputVideo.src = videoUrl;
                
                // Show video element and play/pause overlay
                outputVideo.classList.remove('hidden');
                newPlayPauseOverlay.classList.remove('hidden');
                
                // Wait for metadata to load
                await new Promise((resolve) => {
                    outputVideo.onloadedmetadata = () => {
                        // Show video info panel
                        document.getElementById('outputVideoInfo').classList.remove('hidden');
                        
                        // Update video info
                        outputResolution.textContent = `${outputVideo.videoWidth}×${outputVideo.videoHeight}`;
                        
                        // Format duration as minutes:seconds
                        const minutes = Math.floor(outputVideo.duration / 60);
                        const seconds = Math.floor(outputVideo.duration % 60);
                        outputDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Calculate FPS
                        let fps = calculateFPS(outputVideo);
                        // Round to nearest standard frame rate
                        const standardRates = [23.976, 24, 25, 29.97, 30, 50, 59.94, 60];
                        const closest = standardRates.reduce((prev, curr) => {
                            return Math.abs(curr - fps) < Math.abs(prev - fps) ? curr : prev;
                        });
                        fps = closest;
                        outputFps.textContent = `${fps.toFixed(2)} fps`;
                        
                        // Format size with more precision
                        const sizeMB = file.size / (1024 * 1024);
                        outputSize.textContent = sizeMB >= 1000 
                            ? `${(sizeMB / 1024).toFixed(2)} GB`
                            : `${sizeMB.toFixed(2)} MB`;
                        
                        resolve();
                    };
                });

                // Add play/pause overlay functionality
                newPlayPauseOverlay.addEventListener('click', async () => {
                    try {
                        if (outputVideo.paused) {
                            await outputVideo.play();
                            newPlayPauseOverlay.querySelector('svg').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                        } else {
                            outputVideo.pause();
                            newPlayPauseOverlay.querySelector('svg').innerHTML = '<path d="M8 5v14l11-7z"/>';
                        }
                    } catch (error) {
                        console.error('Error playing video:', error);
                    }
                });

                // Update overlay button when video plays/pauses
                outputVideo.addEventListener('play', () => {
                    newPlayPauseOverlay.querySelector('svg').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                });
                outputVideo.addEventListener('pause', () => {
                    newPlayPauseOverlay.querySelector('svg').innerHTML = '<path d="M8 5v14l11-7z"/>';
                });
                
                // Clean up object URL when video is unloaded
                outputVideo.onunload = () => {
                    URL.revokeObjectURL(videoUrl);
                    outputVideo.classList.add('hidden');
                    newPlayPauseOverlay.classList.add('hidden');
                    document.getElementById('outputVideoInfo').classList.add('hidden');
                };
            } catch (error) {
                console.error('Error loading output video:', error);
                outputVideo.classList.add('hidden');
                outputPlayPauseOverlay.classList.add('hidden');
                document.getElementById('outputVideoInfo').classList.add('hidden');
                throw error;
            }
        }

        // Add video tab functionality
        const videoTabButtons = document.querySelectorAll('.video-tab-button');
        const videoTabPanes = document.querySelectorAll('.video-tab-pane');

        function switchVideoTab(tabId) {
            // Update tab buttons
            videoTabButtons.forEach(button => {
                if (button.dataset.tab === tabId) {
                    button.classList.add('border-blue-500', 'text-blue-400');
                    button.classList.remove('border-transparent', 'text-gray-400', 'hover:text-gray-300', 'hover:border-gray-600');
                } else {
                    button.classList.remove('border-blue-500', 'text-blue-400');
                    button.classList.add('border-transparent', 'text-gray-400', 'hover:text-gray-300', 'hover:border-gray-600');
                }
            });

            // Update tab panes
            videoTabPanes.forEach(pane => {
                if (pane.id === `${tabId}-video-tab`) {
                    pane.classList.remove('hidden');
                } else {
                    pane.classList.add('hidden');
                }
            });
        }

        // Add click handlers for video tabs
        videoTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchVideoTab(button.dataset.tab);
            });
        });

        // Initialize with input video tab
        switchVideoTab('input');

        // Function to append text to debug output
        function appendDebugOutput(text, type = 'info') {
            const debugPanel = document.querySelector('.debug-panel');
            const debugOutput = document.getElementById('debugOutput');
            
            // Show debug panel if it's hidden but debug mode is enabled
            if (settings.debugMode.checked && debugPanel.classList.contains('hidden')) {
                debugPanel.classList.remove('hidden');
            }
            
            const line = document.createElement('div');
            line.className = type;
            line.textContent = text;
            debugOutput.appendChild(line);
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        // Function to clear debug output
        function clearDebugOutput() {
            const debugOutput = document.getElementById('debugOutput');
            debugOutput.innerHTML = '';
        }

        // Batch Processing Functionality
        const batchQueue = [];
        let isBatchProcessing = false;
        let currentBatchIndex = -1;

        // Batch processing UI elements
        const startBatchButton = document.getElementById('startBatch');
        const pauseBatchButton = document.getElementById('pauseBatch');
        const clearBatchButton = document.getElementById('clearBatch');
        const selectBatchFilesButton = document.getElementById('selectBatchFiles');
        const selectBatchFolderButton = document.getElementById('selectBatchFolder');
        const recursiveSearchCheckbox = document.getElementById('recursiveSearch');
        const batchQueueContainer = document.getElementById('batchQueue');
        const batchProgressBar = document.getElementById('batchProgressBar');
        const batchProgressText = document.getElementById('batchProgressText');

        // Function to create a queue item element
        function createQueueItemElement(videoPath, status = 'pending') {
            const item = document.createElement('div');
            item.className = 'bg-white rounded-lg shadow-sm p-4';
            item.dataset.path = videoPath;
            
            const fileName = videoPath.split('/').pop();
            const statusColors = {
                pending: 'text-gray-500',
                processing: 'text-blue-500',
                completed: 'text-green-500',
                failed: 'text-red-500'
            };
            
            item.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium text-gray-900 truncate">${fileName}</div>
                        <div class="text-xs text-gray-500 truncate">${videoPath}</div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-sm ${statusColors[status]}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
                    </div>
                </div>
                <div class="mt-2 text-sm text-gray-600 error-message hidden"></div>
            `;
            
            return item;
        }

        // Function to update queue item status
        function updateQueueItemStatus(videoPath, status, progress = 0, error = null) {
            const item = batchQueueContainer.querySelector(`[data-path="${videoPath}"]`);
            if (!item) return;

            const statusSpan = item.querySelector('span');
            const errorMessage = item.querySelector('.error-message');

            // Update status
            const statusColors = {
                pending: 'text-gray-500',
                processing: 'text-blue-500',
                completed: 'text-green-500',
                failed: 'text-red-500'
            };
            statusSpan.className = `text-sm ${statusColors[status]}`;
            statusSpan.textContent = status.charAt(0).toUpperCase() + status.slice(1);

            // Update error message if any
            if (error) {
                errorMessage.textContent = error;
                errorMessage.classList.remove('hidden');
            } else {
                errorMessage.classList.add('hidden');
            }
        }

        // Function to update batch progress
        function updateBatchProgress() {
            const total = batchQueue.length;
            const completed = batchQueue.filter(item => item.status === 'completed').length;
            const progress = total > 0 ? (completed / total) * 100 : 0;
            
            batchProgressBar.style.width = `${progress}%`;
            batchProgressText.textContent = `${completed}/${total} videos`;
        }

        // Function to add videos to queue
        function addVideosToQueue(videoPaths) {
            for (const path of videoPaths) {
                if (!batchQueue.some(item => item.path === path)) {
                    batchQueue.push({
                        path,
                        status: 'pending',
                        progress: 0
                    });
                    batchQueueContainer.appendChild(createQueueItemElement(path));
                }
            }
            updateBatchProgress();
            startBatchButton.disabled = batchQueue.length === 0;
        }

        // Function to process next video in queue
        async function processNextVideo() {
            if (currentBatchIndex >= batchQueue.length - 1) {
                // All videos processed
                isBatchProcessing = false;
                startBatchButton.classList.remove('hidden');
                pauseBatchButton.classList.add('hidden');
                showStatus('Batch processing completed!', 'success');
                return;
            }

            currentBatchIndex++;
            const video = batchQueue[currentBatchIndex];
            updateQueueItemStatus(video.path, 'processing');

            try {
                // Clean up any existing handlers before starting new process
                cleanupPythonHandlers();

                // Set up handlers before starting process
                setupPythonHandlers();

                // Get current settings
                const objectClassesArray = getSelectedObjectClasses();
                
                // Prepare options object
                const options = {
                    input_path: video.path,
                    output_dir: video.path.substring(0, video.path.lastIndexOf('/')),
                    output_filename: null, // Use default naming
                    target_ratio: parseFloat(settings.targetRatio.value),
                    max_workers: parseInt(settings.maxWorkers.value),
                    detector: 'yolo',
                    skip_frames: parseInt(settings.skipFrames.value),
                    conf_threshold: parseFloat(settings.confThreshold.value),
                    model_size: settings.modelSize,
                    object_classes: objectClassesArray,
                    track_count: parseInt(settings.trackCount.value),
                    padding_ratio: parseFloat(settings.paddingRatio.value),
                    size_weight: parseFloat(settings.sizeWeight.value),
                    center_weight: parseFloat(settings.centerWeight.value),
                    motion_weight: parseFloat(settings.motionWeight.value),
                    history_weight: parseFloat(settings.historyWeight.value),
                    saliency_weight: parseFloat(settings.saliencyWeight.value),
                    face_detection: settings.faceDetection.checked,
                    weighted_center: settings.weightedCenter.checked,
                    blend_saliency: settings.blendSaliency.checked,
                    apply_smoothing: settings.applySmoothing.checked,
                    smoothing_window: parseInt(settings.smoothingWindow.value),
                    position_inertia: parseFloat(settings.positionInertia.value),
                    size_inertia: parseFloat(settings.sizeInertia.value),
                    debug: settings.debugMode.checked,
                    debug_window: settings.debugWindow.checked,
                    show_help: settings.showHelp.checked,
                    recursive_search: settings.recursiveSearch.checked
                };

                // Log settings to debug window
                logSettingsToDebug(options);

                // Process video with current settings
                await window.electronAPI.runPythonScript(video.path, options);
            } catch (error) {
                // Clean up handlers on error
                cleanupPythonHandlers();

                video.status = 'failed';
                updateQueueItemStatus(video.path, 'failed', 0, error.message);
                updateBatchProgress();
                
                // Process next video if not paused
                if (isBatchProcessing) {
                    processNextVideo();
                }
            }
        }

        // Event Listeners for batch processing
        selectBatchFilesButton.addEventListener('click', async () => {
            const filePaths = await window.electronAPI.selectMultipleFiles();
            if (filePaths && filePaths.length > 0) {
                addVideosToQueue(filePaths);
            }
        });

        selectBatchFolderButton.addEventListener('click', async () => {
            const dirPath = await window.electronAPI.selectDirectory();
            if (dirPath) {
                const recursive = recursiveSearchCheckbox.checked;
                const videoPaths = await window.electronAPI.getVideoFilesInDirectory(dirPath, recursive);
                if (videoPaths && videoPaths.length > 0) {
                    addVideosToQueue(videoPaths);
                }
            }
        });

        startBatchButton.addEventListener('click', () => {
            if (batchQueue.length === 0) return;
            
            // Show debug panel if debug mode is enabled
            if (settings.debugMode.checked) {
                const debugPanel = document.querySelector('.debug-panel');
                debugPanel.classList.remove('hidden');
                isDebugExpanded = true;
                document.getElementById('debugOutput').style.display = 'block';
                document.getElementById('toggleDebug').textContent = 'Collapse';
            }
            
            isBatchProcessing = true;
            currentBatchIndex = -1;
            startBatchButton.classList.add('hidden');
            pauseBatchButton.classList.remove('hidden');
            processNextVideo();
        });

        pauseBatchButton.addEventListener('click', () => {
            isBatchProcessing = false;
            startBatchButton.classList.remove('hidden');
            pauseBatchButton.classList.add('hidden');
            showStatus('Batch processing paused', 'info');
        });

        clearBatchButton.addEventListener('click', () => {
            if (isBatchProcessing) {
                isBatchProcessing = false;
                startBatchButton.classList.remove('hidden');
                pauseBatchButton.classList.add('hidden');
            }
            batchQueue.length = 0;
            currentBatchIndex = -1;
            batchQueueContainer.innerHTML = '';
            batchProgressBar.style.width = '0%';
            batchProgressText.textContent = '0/0 videos';
            startBatchButton.disabled = true;
        });

        // Add input type tab functionality
        const inputTypeTabButtons = document.querySelectorAll('.input-type-tab-button');
        const inputTypePanes = document.querySelectorAll('.input-type-pane');

        function switchInputTypeTab(tabId) {
            // Update tab buttons
            inputTypeTabButtons.forEach(button => {
                if (button.dataset.tab === tabId) {
                    button.classList.add('border-blue-500', 'text-blue-600');
                    button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                } else {
                    button.classList.remove('border-blue-500', 'text-blue-600');
                    button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                }
            });

            // Update tab panes
            inputTypePanes.forEach(pane => {
                if (pane.id === `${tabId}-input-tab`) {
                    pane.classList.remove('hidden');
                } else {
                    pane.classList.add('hidden');
                }
            });

            // Reset video preview when switching input types
            if (tabId === 'single') {
                switchVideoTab('input');
            }
        }

        // Add click handlers for input type tabs
        inputTypeTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchInputTypeTab(button.dataset.tab);
            });
        });

        // Initialize with single video input tab
        switchInputTypeTab('single');

        // // Toggle button functionality
        // document.addEventListener('DOMContentLoaded', function() {
        //     const toggleButtons = document.querySelectorAll('.toggle-button');
            
        //     toggleButtons.forEach(toggleButton => {
        //         const checkbox = toggleButton.querySelector('input[type="checkbox"]');
                
        //         // Set initial state
        //         if (checkbox.checked) {
        //             toggleButton.classList.add('active');
        //         }
                
        //         // Handle checkbox change
        //         checkbox.addEventListener('change', function() {
        //             if (this.checked) {
        //                 toggleButton.classList.add('active');
        //             } else {
        //                 toggleButton.classList.remove('active');
        //             }
        //         });
                
        //         // Handle button click
        //         toggleButton.addEventListener('click', function(e) {
        //             e.preventDefault();
        //             checkbox.checked = !checkbox.checked;
        //             checkbox.dispatchEvent(new Event('change'));
        //         });
        //     });
        // });

        // Sync <x-knob> and input
        (function() {
          const knob = document.getElementById('aspectRatioDial');
          const input = document.getElementById('targetRatio');
          if (!knob || !input) return;
          // Sync knob -> input
          knob.addEventListener('input', function() {
            input.value = knob.value;
            input.dispatchEvent(new Event('input', {bubbles:true}));
          });
          // Sync input -> knob
          input.addEventListener('input', function() {
            knob.value = input.value;
          });
        })();

        // Add calculate ratio button handler
        document.getElementById('calculateRatio').addEventListener('click', function() {
            const width = parseFloat(document.getElementById('widthInput').value);
            const height = parseFloat(document.getElementById('heightInput').value);
            
            if (!isNaN(width) && !isNaN(height) && height !== 0) {
                const ratio = width / height;
                const knob = document.getElementById('aspectRatioDial');
                const input = document.getElementById('targetRatio');
                
                // Update both knob and input
                knob.value = ratio;
                input.value = ratio;
                input.dispatchEvent(new Event('input', {bubbles:true}));
            }
        });

        // Form persistence functions
        function saveFormValues() {
            const formData = {
                // Basic settings
                targetRatio: document.getElementById('targetRatio').value,
                maxWorkers: document.getElementById('maxWorkers').value,
                
                // Detection settings
                skipFrames: document.getElementById('skipFrames').value,
                confThreshold: document.getElementById('confThreshold').value,
                modelSize: settings.modelSize,
                objectClasses: getSelectedObjectClasses(),
                trackCount: document.getElementById('trackCount').value,
                
                // Crop settings
                paddingRatio: document.getElementById('paddingRatio').value,
                sizeWeight: document.getElementById('sizeWeight').value,
                centerWeight: document.getElementById('centerWeight').value,
                motionWeight: document.getElementById('motionWeight').value,
                historyWeight: document.getElementById('historyWeight').value,
                saliencyWeight: document.getElementById('saliencyWeight').value,
                
                // Feature toggles
                faceDetection: document.getElementById('faceDetection').checked,
                weightedCenter: document.getElementById('weightedCenter').checked,
                blendSaliency: document.getElementById('blendSaliency').checked,
                
                // Smoothing settings
                applySmoothing: document.getElementById('applySmoothing').checked,
                smoothingWindow: document.getElementById('smoothingWindow').value,
                positionInertia: document.getElementById('positionInertia').value,
                sizeInertia: document.getElementById('sizeInertia').value,
                
                // Debug settings
                debug: document.getElementById('debugMode').checked,
                debugWindow: document.getElementById('debugWindow').checked,
                showHelp: document.getElementById('showHelp').checked,
                
                // Batch settings
                recursiveSearch: document.getElementById('recursiveSearch').checked
            };
            
            localStorage.setItem('reframerFormData', JSON.stringify(formData));
        }

        function loadFormValues() {
            const savedData = localStorage.getItem('reframerFormData');
            if (!savedData) return;
            
            try {
                const formData = JSON.parse(savedData);
                
                // Load basic settings
                if (formData.targetRatio) {
                    document.getElementById('targetRatio').value = formData.targetRatio;
                    document.getElementById('aspectRatioDial').value = formData.targetRatio;
                }
                if (formData.maxWorkers) document.getElementById('maxWorkers').value = formData.maxWorkers;
                
                // Load detection settings
                if (formData.skipFrames) document.getElementById('skipFrames').value = formData.skipFrames;
                if (formData.confThreshold) document.getElementById('confThreshold').value = formData.confThreshold;
                if (formData.modelSize) setModelSize(formData.modelSize);
                if (formData.objectClasses) setSelectedObjectClasses(formData.objectClasses);
                if (formData.trackCount) document.getElementById('trackCount').value = formData.trackCount;
                
                // Load crop settings
                if (formData.paddingRatio) document.getElementById('paddingRatio').value = formData.paddingRatio;
                if (formData.sizeWeight) document.getElementById('sizeWeight').value = formData.sizeWeight;
                if (formData.centerWeight) document.getElementById('centerWeight').value = formData.centerWeight;
                if (formData.motionWeight) document.getElementById('motionWeight').value = formData.motionWeight;
                if (formData.historyWeight) document.getElementById('historyWeight').value = formData.historyWeight;
                if (formData.saliencyWeight) document.getElementById('saliencyWeight').value = formData.saliencyWeight;
                
                // Load feature toggles
                if (formData.faceDetection !== undefined) {
                    document.getElementById('faceDetection').checked = formData.faceDetection;
                    updateToggleButtonState('faceDetection');
                }
                if (formData.weightedCenter !== undefined) {
                    document.getElementById('weightedCenter').checked = formData.weightedCenter;
                    updateToggleButtonState('weightedCenter');
                }
                if (formData.blendSaliency !== undefined) {
                    document.getElementById('blendSaliency').checked = formData.blendSaliency;
                    updateToggleButtonState('blendSaliency');
                }
                
                // Load smoothing settings
                if (formData.applySmoothing !== undefined) {
                    document.getElementById('applySmoothing').checked = formData.applySmoothing;
                    updateToggleButtonState('applySmoothing');
                }
                if (formData.smoothingWindow) document.getElementById('smoothingWindow').value = formData.smoothingWindow;
                if (formData.positionInertia) document.getElementById('positionInertia').value = formData.positionInertia;
                if (formData.sizeInertia) document.getElementById('sizeInertia').value = formData.sizeInertia;
                
                // Load debug settings
                if (formData.debug !== undefined) {
                    document.getElementById('debugMode').checked = formData.debug;
                    updateToggleButtonState('debugMode');
                }
                if (formData.debugWindow !== undefined) {
                    document.getElementById('debugWindow').checked = formData.debugWindow;
                    updateToggleButtonState('debugWindow');
                }
                if (formData.showHelp !== undefined) {
                    document.getElementById('showHelp').checked = formData.showHelp;
                    updateToggleButtonState('showHelp');
                }
                
                // Load batch settings
                if (formData.recursiveSearch !== undefined) {
                    document.getElementById('recursiveSearch').checked = formData.recursiveSearch;
                    updateToggleButtonState('recursiveSearch');
                }
                
            } catch (error) {
                console.error('Error loading saved form data:', error);
            }
        }

        function updateToggleButtonState(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            const toggleButton = checkbox.closest('.toggle-button');
            if (toggleButton) {
                if (checkbox.checked) {
                    toggleButton.classList.add('active');
                } else {
                    toggleButton.classList.remove('active');
                }
            }
        }

        // Toggle button functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved values first
            loadFormValues();
            
            const toggleButtons = document.querySelectorAll('.toggle-button');
            
            toggleButtons.forEach(toggleButton => {
                const checkbox = toggleButton.querySelector('input[type="checkbox"]');
                
                // Set initial state
                if (checkbox.checked) {
                    toggleButton.classList.add('active');
                } else {
                    toggleButton.classList.remove('active');
                }
                
                // Handle checkbox change
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        toggleButton.classList.add('active');
                    } else {
                        toggleButton.classList.remove('active');
                    }
                    saveFormValues(); // Save on change
                });
                
                // Handle button click (not on checkbox itself)
                toggleButton.addEventListener('click', function(e) {
                    if (e.target !== checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
            });
            
            // Add change listeners to all form inputs
            const formInputs = document.querySelectorAll('input[type="number"], input[type="text"], select');
            formInputs.forEach(input => {
                input.addEventListener('change', saveFormValues);
                input.addEventListener('input', saveFormValues);
            });
            
            // Add event listeners for aspect ratio preset buttons
            const presetButtons = document.querySelectorAll('.aspect-ratio-preset');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const ratio = parseFloat(this.dataset.ratio);
                    const knob = document.getElementById('aspectRatioDial');
                    const input = document.getElementById('targetRatio');
                    
                    // Update both knob and input
                    knob.value = ratio;
                    input.value = ratio;
                    input.dispatchEvent(new Event('input', {bubbles:true}));
                    
                    // Save the new value
                    saveFormValues();
                });
            });
        });

        // Object classes definitions
        const objectClasses = [
            { id: 0, name: 'person' },
            { id: 1, name: 'bicycle' },
            { id: 2, name: 'car' },
            { id: 3, name: 'motorcycle' },
            { id: 4, name: 'airplane' },
            { id: 5, name: 'bus' },
            { id: 6, name: 'train' },
            { id: 7, name: 'truck' },
            { id: 8, name: 'boat' },
            { id: 9, name: 'traffic light' },
            { id: 10, name: 'fire hydrant' },
            { id: 11, name: 'stop sign' },
            { id: 12, name: 'parking meter' },
            { id: 13, name: 'bench' },
            { id: 14, name: 'bird' },
            { id: 15, name: 'cat' },
            { id: 16, name: 'dog' },
            { id: 17, name: 'horse' },
            { id: 18, name: 'sheep' },
            { id: 19, name: 'cow' },
            { id: 20, name: 'elephant' },
            { id: 21, name: 'bear' },
            { id: 22, name: 'zebra' },
            { id: 23, name: 'giraffe' },
            { id: 24, name: 'backpack' },
            { id: 25, name: 'umbrella' },
            { id: 26, name: 'handbag' },
            { id: 27, name: 'tie' },
            { id: 28, name: 'suitcase' },
            { id: 29, name: 'frisbee' },
            { id: 30, name: 'skis' },
            { id: 31, name: 'snowboard' },
            { id: 32, name: 'sports ball' },
            { id: 33, name: 'kite' },
            { id: 34, name: 'baseball bat' },
            { id: 35, name: 'baseball glove' },
            { id: 36, name: 'skateboard' },
            { id: 37, name: 'surfboard' },
            { id: 38, name: 'tennis racket' },
            { id: 39, name: 'bottle' },
            { id: 40, name: 'wine glass' },
            { id: 41, name: 'cup' },
            { id: 42, name: 'fork' },
            { id: 43, name: 'knife' },
            { id: 44, name: 'spoon' },
            { id: 45, name: 'bowl' },
            { id: 46, name: 'banana' },
            { id: 47, name: 'apple' },
            { id: 48, name: 'sandwich' },
            { id: 49, name: 'orange' },
            { id: 50, name: 'broccoli' },
            { id: 51, name: 'carrot' },
            { id: 52, name: 'hot dog' },
            { id: 53, name: 'pizza' },
            { id: 54, name: 'donut' },
            { id: 55, name: 'cake' },
            { id: 56, name: 'chair' },
            { id: 57, name: 'couch' },
            { id: 58, name: 'potted plant' },
            { id: 59, name: 'bed' },
            { id: 60, name: 'dining table' },
            { id: 61, name: 'toilet' },
            { id: 62, name: 'tv' },
            { id: 63, name: 'laptop' },
            { id: 64, name: 'mouse' },
            { id: 65, name: 'remote' },
            { id: 66, name: 'keyboard' },
            { id: 67, name: 'cell phone' },
            { id: 68, name: 'microwave' },
            { id: 69, name: 'oven' },
            { id: 70, name: 'toaster' },
            { id: 71, name: 'sink' },
            { id: 72, name: 'refrigerator' },
            { id: 73, name: 'book' },
            { id: 74, name: 'clock' },
            { id: 75, name: 'vase' },
            { id: 76, name: 'scissors' },
            { id: 77, name: 'teddy bear' },
            { id: 78, name: 'hair drier' },
            { id: 79, name: 'toothbrush' }
        ];

        // Common object classes (person, car, bicycle, motorcycle, bus, truck, dog, cat, chair, couch)
        const commonObjectClasses = [0, 2, 1, 3, 5, 7, 16, 15, 56, 57];

        // Generate object class toggle buttons
        function generateObjectClassButtons() {
            const grid = document.getElementById('objectClassesGrid');
            grid.innerHTML = '';

            objectClasses.forEach(objClass => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'object-class-btn px-2 py-1 text-xs border rounded cursor-pointer transition-colors';
                button.dataset.classId = objClass.id;
                button.textContent = `${objClass.id}: ${objClass.name}`;
                
                // Set initial state (only person selected by default)
                if (objClass.id === 0) {
                    button.classList.add('bg-blue-500', 'text-white', 'border-blue-600');
                    button.classList.remove('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
                } else {
                    button.classList.add('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
                    button.classList.remove('bg-blue-500', 'text-white', 'border-blue-600');
                }

                button.addEventListener('click', () => {
                    toggleObjectClass(objClass.id, button);
                });

                grid.appendChild(button);
            });
        }

        // Toggle object class selection
        function toggleObjectClass(classId, button) {
            const isSelected = button.classList.contains('bg-blue-500');
            
            if (isSelected) {
                button.classList.remove('bg-blue-500', 'text-white', 'border-blue-600');
                button.classList.add('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
            } else {
                button.classList.add('bg-blue-500', 'text-white', 'border-blue-600');
                button.classList.remove('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
            }
            
            // Save form values when object classes change
            saveFormValues();
        }

        // Get selected object classes as array
        function getSelectedObjectClasses() {
            const selectedButtons = document.querySelectorAll('.object-class-btn.bg-blue-500');
            return Array.from(selectedButtons).map(button => parseInt(button.dataset.classId));
        }

        // Set selected object classes from array
        function setSelectedObjectClasses(classIds) {
            const buttons = document.querySelectorAll('.object-class-btn');
            buttons.forEach(button => {
                const classId = parseInt(button.dataset.classId);
                const isSelected = classIds.includes(classId);
                
                if (isSelected) {
                    button.classList.add('bg-blue-500', 'text-white', 'border-blue-600');
                    button.classList.remove('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
                } else {
                    button.classList.remove('bg-blue-500', 'text-white', 'border-blue-600');
                    button.classList.add('bg-gray-200', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-300');
                }
            });
        }

        // Initialize object class buttons
        generateObjectClassButtons();

        // Add responsive grid functionality for Electron compatibility
        function updateGridResponsiveness() {
            const grid = document.getElementById('objectClassesGrid');
            if (!grid) return;
            
            const containerWidth = grid.offsetWidth;
            let columns = 3; // Default for mobile
            
            if (containerWidth >= 1024) {
                columns = 6; // Large screens
            } else if (containerWidth >= 768) {
                columns = 5; // Medium screens
            } else if (containerWidth >= 640) {
                columns = 4; // Small screens
            }
            
            grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            
            // Update debug info
            const debugInfo = document.getElementById('gridDebugInfo');
            if (debugInfo) {
                debugInfo.textContent = `${containerWidth}px - ${columns} columns`;
            }
        }

        // Add event listeners for object class control buttons
        document.getElementById('selectAllClasses').addEventListener('click', () => {
            setSelectedObjectClasses(objectClasses.map(c => c.id));
            saveFormValues();
        });

        document.getElementById('deselectAllClasses').addEventListener('click', () => {
            setSelectedObjectClasses([]);
            saveFormValues();
        });

        document.getElementById('selectCommonClasses').addEventListener('click', () => {
            setSelectedObjectClasses(commonObjectClasses);
            saveFormValues();
        });

        // Add resize listener for responsive grid
        window.addEventListener('resize', updateGridResponsiveness);
        
        // Initial call to set up responsive grid
        setTimeout(updateGridResponsiveness, 100);

        // Model size button functionality
        function initializeModelSizeButtons() {
            const buttons = document.querySelectorAll('.model-size-btn');
            console.log('Found model size buttons:', buttons.length);
            
            // Set initial selection (XLarge by default)
            const defaultButton = document.querySelector('.model-size-btn[data-value="x"]');
            if (defaultButton) {
                defaultButton.classList.add('selected');
                console.log('Set default model size to XLarge');
            } else {
                console.log('Could not find XLarge button');
            }
            
            // Add click handlers
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    console.log('Model size button clicked:', button.dataset.value);
                    // Remove selection from all buttons
                    buttons.forEach(btn => btn.classList.remove('selected'));
                    // Add selection to clicked button
                    button.classList.add('selected');
                    console.log('Selected model size:', button.dataset.value);
                    // Save form values
                    saveFormValues();
                });
            });
        }

        // Consolidated initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved values first
            loadFormValues();
            
            // Initialize model size buttons
            initializeModelSizeButtons();
            
            // Initialize toggle buttons
            const toggleButtons = document.querySelectorAll('.toggle-button');
            
            toggleButtons.forEach(toggleButton => {
                const checkbox = toggleButton.querySelector('input[type="checkbox"]');
                
                // Set initial state
                if (checkbox.checked) {
                    toggleButton.classList.add('active');
                } else {
                    toggleButton.classList.remove('active');
                }
                
                // Handle checkbox change
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        toggleButton.classList.add('active');
                    } else {
                        toggleButton.classList.remove('active');
                    }
                    saveFormValues(); // Save on change
                });
                
                // Handle button click (not on checkbox itself)
                toggleButton.addEventListener('click', function(e) {
                    if (e.target !== checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
            });
            
            // Add change listeners to all form inputs
            const formInputs = document.querySelectorAll('input[type="number"], input[type="text"], select');
            formInputs.forEach(input => {
                input.addEventListener('change', saveFormValues);
                input.addEventListener('input', saveFormValues);
            });
            
            // Add event listeners for aspect ratio preset buttons
            const presetButtons = document.querySelectorAll('.aspect-ratio-preset');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const ratio = parseFloat(this.dataset.ratio);
                    const knob = document.getElementById('aspectRatioDial');
                    const input = document.getElementById('targetRatio');
                    
                    // Update both knob and input
                    knob.value = ratio;
                    input.value = ratio;
                    input.dispatchEvent(new Event('input', {bubbles:true}));
                    
                    // Save the new value
                    saveFormValues();
                });
            });
            
            // Initialize object class buttons after DOM is loaded
            generateObjectClassButtons();
            
            // Add event listeners for object class control buttons
            const selectAllBtn = document.getElementById('selectAllClasses');
            const deselectAllBtn = document.getElementById('deselectAllClasses');
            const selectCommonBtn = document.getElementById('selectCommonClasses');
            
            if (selectAllBtn) {
                selectAllBtn.addEventListener('click', () => {
                    setSelectedObjectClasses(objectClasses.map(c => c.id));
                    saveFormValues();
                });
            }
            
            if (deselectAllBtn) {
                deselectAllBtn.addEventListener('click', () => {
                    setSelectedObjectClasses([]);
                    saveFormValues();
                });
            }
            
            if (selectCommonBtn) {
                selectCommonBtn.addEventListener('click', () => {
                    setSelectedObjectClasses(commonObjectClasses);
                    saveFormValues();
                });
            }
            
            // Add resize listener for responsive grid
            window.addEventListener('resize', updateGridResponsiveness);
            
            // Initial call to set up responsive grid
            setTimeout(updateGridResponsiveness, 100);
        });

        // Function to set model size from saved value
        function setModelSize(value) {
            const buttons = document.querySelectorAll('.model-size-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            const targetButton = document.querySelector(`.model-size-btn[data-value="${value}"]`);
            if (targetButton) {
                targetButton.classList.add('selected');
            }
        }
    </script>
</body>
</html>